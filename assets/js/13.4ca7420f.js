(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{513:function(s,t,a){"use strict";a.r(t);var n=a(21),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"问题起源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题起源"}},[s._v("#")]),s._v(" 问题起源")]),s._v(" "),a("p",[s._v("问题起源于我在使用Docker部署的Jenkins服务时，需要通过Jenkins实现Docker的持续集成，尝试使用Docker的远程Api，\n但是由于本机服务器内存不足的原因，在build镜像时总是出现内存溢出的错误。")]),s._v(" "),a("h2",{attrs:{id:"解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -u root "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(":8080 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50000")]),s._v(":50000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --privileged "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -v /var/run/docker.sock:/var/run/docker.sock "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -v "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(":/bin/docker "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -v jenkins:/var/jenkins_home "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n -v /etc/localtime:/etc/localtime "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --name jenkins docker.io/jenkins/jenkins\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解析"}},[s._v("#")]),s._v(" 解析")]),s._v(" "),a("h3",{attrs:{id:"_1-privileged"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-privileged"}},[s._v("#")]),s._v(" 1. --privileged")]),s._v(" "),a("p",[s._v("大约在0.6版，privileged被引入docker。使用该参数，container内的root拥有真正的root权限。\n否则，container内的root只是外部的一个普通用户权限。")]),s._v(" "),a("h3",{attrs:{id:"_2-u-root"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-u-root"}},[s._v("#")]),s._v(" 2. "),a("strong",[s._v("-u root")])]),s._v(" "),a("p",[s._v("使用root用户创建容器")]),s._v(" "),a("blockquote",[a("p",[s._v("只使用"),a("code",[s._v("--privileged")]),s._v("仍不能获取root权限（不知道为啥），但是加上"),a("code",[s._v("-u root")]),s._v("就可以了")])]),s._v(" "),a("h3",{attrs:{id:"_3-挂载宿主机docker文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-挂载宿主机docker文件"}},[s._v("#")]),s._v(" 3. 挂载宿主机Docker文件")]),s._v(" "),a("p",[a("code",[s._v("/var/run/docker.sock")]),s._v("：Unix socket，Docker进程默认监听文件，为进行container进程间通信所用。")]),s._v(" "),a("p",[a("code",[s._v("$(which docker)")]),s._v("：将docker命令挂载进容器中")]),s._v(" "),a("p",[a("code",[s._v("/etc/localtime")]),s._v("：解决容器与宿主机的时间时区不一致的问题")])])}),[],!1,null,null,null);t.default=e.exports}}]);
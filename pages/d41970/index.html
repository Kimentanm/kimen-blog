<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【NAS In Docker】重要数据备份并自动上传至阿里云盘 | Kimen&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="全栈技术博客, 包括前后端、数据库、运维部署、折腾搞机、NAS等众多内容">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.d732307f.css" as="style"><link rel="preload" href="/assets/js/app.b9fd245f.js" as="script"><link rel="preload" href="/assets/js/2.e5fceb6b.js" as="script"><link rel="preload" href="/assets/js/24.f08b622f.js" as="script"><link rel="prefetch" href="/assets/js/10.2d3c65b0.js"><link rel="prefetch" href="/assets/js/11.6137b2ba.js"><link rel="prefetch" href="/assets/js/12.815d26e4.js"><link rel="prefetch" href="/assets/js/13.4ca7420f.js"><link rel="prefetch" href="/assets/js/14.d115704c.js"><link rel="prefetch" href="/assets/js/15.73d97b76.js"><link rel="prefetch" href="/assets/js/16.26d5f3d8.js"><link rel="prefetch" href="/assets/js/17.c8c25c64.js"><link rel="prefetch" href="/assets/js/18.7e15f7af.js"><link rel="prefetch" href="/assets/js/19.e9ee2ae5.js"><link rel="prefetch" href="/assets/js/20.a83b448c.js"><link rel="prefetch" href="/assets/js/21.66408938.js"><link rel="prefetch" href="/assets/js/22.e477a33c.js"><link rel="prefetch" href="/assets/js/23.bdd42d81.js"><link rel="prefetch" href="/assets/js/25.f791afc1.js"><link rel="prefetch" href="/assets/js/26.0f8fbe79.js"><link rel="prefetch" href="/assets/js/27.a4244636.js"><link rel="prefetch" href="/assets/js/28.fbc07329.js"><link rel="prefetch" href="/assets/js/29.0b745664.js"><link rel="prefetch" href="/assets/js/3.5cbda867.js"><link rel="prefetch" href="/assets/js/30.2ca5ff1a.js"><link rel="prefetch" href="/assets/js/31.a350bbfc.js"><link rel="prefetch" href="/assets/js/32.a6d6402a.js"><link rel="prefetch" href="/assets/js/33.eaf645a2.js"><link rel="prefetch" href="/assets/js/34.4e0faa97.js"><link rel="prefetch" href="/assets/js/35.46f19bc5.js"><link rel="prefetch" href="/assets/js/4.8a96be4a.js"><link rel="prefetch" href="/assets/js/5.189a58bd.js"><link rel="prefetch" href="/assets/js/6.300604e7.js"><link rel="prefetch" href="/assets/js/7.058e55ab.js"><link rel="prefetch" href="/assets/js/8.f1cc58ae.js"><link rel="prefetch" href="/assets/js/9.9a69de26.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d732307f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpeg" alt="Kimen's blog" class="logo"> <span class="site-name can-hide">Kimen's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0fb788/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d41970/404" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/69b834/" class="nav-link">数据库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8ce4c8/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/61e8fc/" class="nav-link">经验之谈</a></li><li class="dropdown-item"><!----> <a href="/pages/b2cfaa/" class="nav-link">疑难杂症</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/1ebf5b/" class="nav-link">IDE</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/809d08/" class="nav-link">MAC软件分享</a></li><li class="dropdown-item"><!----> <a href="/pages/d7e20d/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/2aae23/" class="nav-link">运维</a></li><li class="dropdown-item"><!----> <a href="/pages/3426a4/" class="nav-link">折腾</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/kimentanm/kimen-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpeg"> <div class="blogger-info"><h3>Kimen Tang</h3> <span>全沾打工人</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0fb788/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/d41970/404" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/69b834/" class="nav-link">数据库</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8ce4c8/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/61e8fc/" class="nav-link">经验之谈</a></li><li class="dropdown-item"><!----> <a href="/pages/b2cfaa/" class="nav-link">疑难杂症</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><a href="/tool/" class="link-title">工具</a> <span class="title" style="display:none;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/1ebf5b/" class="nav-link">IDE</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/809d08/" class="nav-link">MAC软件分享</a></li><li class="dropdown-item"><!----> <a href="/pages/d7e20d/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/2aae23/" class="nav-link">运维</a></li><li class="dropdown-item"><!----> <a href="/pages/3426a4/" class="nav-link">折腾</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/kimentanm/kimen-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MAC软件分享</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>运维</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>折腾</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/3426a4/" class="sidebar-link">【NAS In Docker】👨‍👩‍👧‍👦家庭数据中心 = 闲置台式机 + Docker</a></li><li><a href="/pages/d41970/" aria-current="page" class="active sidebar-link">【NAS In Docker】重要数据备份并自动上传至阿里云盘</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/d41970/#压缩" class="sidebar-link">压缩</a></li><li class="sidebar-sub-header level2"><a href="/pages/d41970/#加密" class="sidebar-link">加密</a></li><li class="sidebar-sub-header level2"><a href="/pages/d41970/#解密" class="sidebar-link">解密</a></li><li class="sidebar-sub-header level2"><a href="/pages/d41970/#阿里云盘配置" class="sidebar-link">阿里云盘配置</a></li><li class="sidebar-sub-header level2"><a href="/pages/d41970/#获取阿里云盘的refresh-token" class="sidebar-link">获取阿里云盘的REFRESH_TOKEN</a></li><li class="sidebar-sub-header level2"><a href="/pages/d41970/#其他配置" class="sidebar-link">其他配置</a></li><li class="sidebar-sub-header level2"><a href="/pages/d41970/#定时执行脚本" class="sidebar-link">定时执行脚本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d41970/#crond常用命令" class="sidebar-link">crond常用命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/d41970/#crontab常用命令" class="sidebar-link">crontab常用命令</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/d41970/#收工" class="sidebar-link">收工</a></li><li class="sidebar-sub-header level2"><a href="/pages/d41970/#附-脚本文件" class="sidebar-link">附：脚本文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/d41970/#大神的脚本" class="sidebar-link">大神的脚本</a></li><li class="sidebar-sub-header level3"><a href="/pages/d41970/#本文使用的脚本" class="sidebar-link">本文使用的脚本</a></li></ul></li></ul></li><li><a href="/pages/9b3f3a/" class="sidebar-link">当『Infuse』遇上『阿里云盘』 🚀</a></li><li><a href="/pages/5ee34a/" class="sidebar-link">当『Emby、Plex、Jellyfin』遇上『阿里云盘』🎬</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/more/#更多" data-v-1baff76c>更多</a></li><li data-v-1baff76c><a href="/more/#折腾" data-v-1baff76c>折腾</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="https://github.com/Kimentanm" target="_blank" title="作者" class="beLink" data-v-1baff76c>Kimen</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2021-05-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">【NAS In Docker】重要数据备份并自动上传至阿里云盘<!----></h1>  <div class="theme-vdoing-content content__default"><hr> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>修改自<a href="https://teddysun.com/469.html" target="_blank" rel="noopener noreferrer">秋水逸冰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的backup.sh脚本
参考自WeiCN的教程：<a href="https://cuojue.org/read/backup-sh.html" target="_blank" rel="noopener noreferrer">一键备份脚本backup.sh(新增支持COS/阿里云盘)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
本文只关注阿里云盘的上传</p></div> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>数据备份拢共分三步</p> <ul><li>压缩文件或文件夹</li> <li>加密压缩好的文件</li> <li>将加密好的文件上传至网盘</li></ul></div> <h2 id="压缩"><a href="#压缩" class="header-anchor">#</a> 压缩</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 存储压缩文件的目录</span>
<span class="token assign-left variable">LOCALDIR</span><span class="token operator">=</span><span class="token string">&quot;/root/backup/file/&quot;</span>
<span class="token comment"># 创建备份时的临时目录</span>
<span class="token assign-left variable">TEMPDIR</span><span class="token operator">=</span><span class="token string">&quot;/root/backup/temp/&quot;</span>
<span class="token comment"># 备份时脚本产生的log文件（注意是文件不是目录）</span>
<span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span><span class="token string">&quot;/root/backup/backup.log&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 待压缩文件夹</span>
<span class="token comment"># BACKUP是一个数组变量，可以存放多个PATH</span>
BACKUP<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;/data/www/default/test1&quot;</span>
BACKUP<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;/data/www/default/test2&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="加密"><a href="#加密" class="header-anchor">#</a> 加密</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 是否加密</span>
<span class="token assign-left variable">ENCRYPTFLG</span><span class="token operator">=</span>true
<span class="token comment"># 加密秘钥</span>
<span class="token assign-left variable">BACKUPPASS</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>加密命令：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>openssl enc -aes256 -in <span class="token string">&quot;源文件PATH&quot;</span> -out <span class="token string">&quot;输出文件PATH&quot;</span> -pass pass:<span class="token string">&quot;加密秘钥&quot;</span> -md sha256
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="解密"><a href="#解密" class="header-anchor">#</a> 解密</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>openssl enc -aes256 -in <span class="token string">&quot;待解密文件PATH&quot;</span> -out decrypted_backup.tgz -pass pass:<span class="token string">&quot;加密秘钥&quot;</span> -d -md sha256
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="阿里云盘配置"><a href="#阿里云盘配置" class="header-anchor">#</a> 阿里云盘配置</h2> <p>阿里云盘cli地址 <a href="https://github.com/wxy1343/aliyunpan" target="_blank" rel="noopener noreferrer">aliyunpan<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 阿里云盘上的远程地址，从根目录开始算起，可以不写`/`</span>
<span class="token assign-left variable">ALI_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;backup&quot;</span>
<span class="token comment"># 是否开启上传</span>
<span class="token assign-left variable">ALI_FLG</span><span class="token operator">=</span>true
<span class="token comment"># aliyunpan中的main.py文件地址</span>
<span class="token assign-left variable">ALI_PY_FILE</span><span class="token operator">=</span><span class="token string">&quot;main.py&quot;</span>
<span class="token comment"># 阿里云盘免登陆token</span>
<span class="token assign-left variable">ALI_REFRESH_TOKEN</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="获取阿里云盘的refresh-token"><a href="#获取阿里云盘的refresh-token" class="header-anchor">#</a> 获取阿里云盘的REFRESH_TOKEN</h2> <ul><li>登录网页版<a href="https://www.aliyundrive.com/" target="_blank" rel="noopener noreferrer">阿里云盘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>F12打开控制台</li> <li>找到Local Storage中Key为token的值</li> <li>在上一步的值中找到refresh_token，收工</li> <li>必须得再来个图，不然浑身难受 <img src="https://img.whalenas.com:283/image/20210520171418.png" alt=""></li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>拿到REFRESH_TOKEN后，如果重新登录之前的token就会失效，需要重新获取</p></div> <h2 id="其他配置"><a href="#其他配置" class="header-anchor">#</a> 其他配置</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 定期删除备份文件的天数，默认7天，也即只会保存近7天的备份文件</span>
<span class="token assign-left variable">LOCALAGEDAILIES</span><span class="token operator">=</span><span class="token string">&quot;7&quot;</span>
<span class="token comment"># 是否删除远程文件，默认true</span>
<span class="token assign-left variable">DELETE_REMOTE_FILE_FLG</span><span class="token operator">=</span>true
<span class="token comment"># MySQL/MariaDB/Percona 的 root 用户密码</span>
<span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token comment"># 指定 MySQL/MariaDB/Percona 的数据库名，留空则是备份所有数据库</span>
<span class="token comment"># MYSQL_DATABASE_NAME 是一个数组变量，可以指定多个</span>
MYSQL_DATABASE_NAME<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;admin&quot;</span>
MYSQL_DATABASE_NAME<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;test&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="定时执行脚本"><a href="#定时执行脚本" class="header-anchor">#</a> 定时执行脚本</h2> <p>必须使用root权限执行脚本，创建Linux定时任务，每天晚上凌晨4点执行备份脚本</p> <h3 id="crond常用命令"><a href="#crond常用命令" class="header-anchor">#</a> crond常用命令</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>systemctl start   crond         <span class="token comment">#启动服务</span>
systemctl stop    crond         <span class="token comment">#停止服务</span>
systemctl restart crond         <span class="token comment">#重启服务</span>
systemctl reload  crond         <span class="token comment">#重载配置文件</span>
systemctl status  crond         <span class="token comment">#查看状态</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="crontab常用命令"><a href="#crontab常用命令" class="header-anchor">#</a> crontab常用命令</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">crontab</span> -u 		<span class="token comment">#设定某个用户的cron服务</span>
<span class="token function">crontab</span> -l		<span class="token comment">#显示crontab文件(显示已设置的定时任务)</span>
<span class="token function">crontab</span> -e		<span class="token comment">#编辑crontab文件(编辑定时任务)</span>
<span class="token function">crontab</span> -r		<span class="token comment">#删除crontab文件(删除定时任务)</span>
<span class="token function">crontab</span> -i		<span class="token comment">#删除crontab文件提醒用户(删除定时任务)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># Example of job definition:</span>
<span class="token comment"># .---------------- minute (0 - 59)</span>
<span class="token comment"># |  .------------- hour (0 - 23)</span>
<span class="token comment"># |  |  .---------- day of month (1 - 31)</span>
<span class="token comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="token comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="token comment"># |  |  |  |  |</span>
<span class="token comment"># *  *  *  *  * user-name  command to be executed</span>
  <span class="token number">0</span>  <span class="token number">4</span>  *  *  * /root/backup.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="收工"><a href="#收工" class="header-anchor">#</a> 收工</h2> <p>最后就可以在阿里云盘中看到备份好上传的以.文件了
<img src="https://img.whalenas.com:283/image/20210521152831.png" alt=""></p> <h2 id="附-脚本文件"><a href="#附-脚本文件" class="header-anchor">#</a> 附：脚本文件</h2> <h3 id="大神的脚本"><a href="#大神的脚本" class="header-anchor">#</a> 大神的脚本</h3> <p><a href="https://github.com/teddysun/across/raw/master/backup.sh" target="_blank" rel="noopener noreferrer">https://github.com/teddysun/across/raw/master/backup.sh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="本文使用的脚本"><a href="#本文使用的脚本" class="header-anchor">#</a> 本文使用的脚本</h3> <details class="custom-block details"><summary>点击查看</summary> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env bash</span>
<span class="token comment"># Copyright (C) 2013 - 2020 Teddysun &lt;i@teddysun.com&gt;</span>
<span class="token comment">#</span>
<span class="token comment"># This file is part of the LAMP script.</span>
<span class="token comment">#</span>
<span class="token comment"># LAMP is a powerful bash script for the installation of</span>
<span class="token comment"># Apache + PHP + MySQL/MariaDB and so on.</span>
<span class="token comment"># You can install Apache + PHP + MySQL/MariaDB in an very easy way.</span>
<span class="token comment"># Just need to input numbers to choose what you want to install before installation.</span>
<span class="token comment"># And all things will be done in a few minutes.</span>
<span class="token comment">#</span>
<span class="token comment"># Description:      Auto backup shell script</span>
<span class="token comment"># Description URL:  https://teddysun.com/469.html</span>
<span class="token comment">#</span>
<span class="token comment"># Website:  https://lamp.sh</span>
<span class="token comment"># Github:   https://github.com/teddysun/lamp</span>
<span class="token comment">#</span>
<span class="token comment"># You must to modify the config before run it!!!</span>
<span class="token comment"># Backup MySQL/MariaDB datebases, files and directories</span>
<span class="token comment"># Backup file is encrypted with AES256-cbc with SHA1 message-digest (option)</span>
<span class="token comment"># Auto transfer backup file to Google Drive (need install rclone command) (option)</span>
<span class="token comment"># Auto transfer backup file to FTP server (option)</span>
<span class="token comment"># Auto delete Google Drive's or FTP server's remote file (option)</span>

<span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token environment constant">$EUID</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;Error: This script must be run as root!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span>

<span class="token comment">########## START OF CONFIG ##########</span>

<span class="token comment"># Encrypt flag (true: encryspt, false: not encrypt)</span>
<span class="token assign-left variable">ENCRYPTFLG</span><span class="token operator">=</span>true

<span class="token comment"># WARNING: KEEP THE PASSWORD SAFE!!!</span>
<span class="token comment"># The password used to encrypt the backup</span>
<span class="token comment"># To decrypt backups made by this script, run the following command:</span>
<span class="token comment"># openssl enc -aes256 -in [ENCRYPTED BACKUP] -out decrypted_backup.tgz -pass pass:[BACKUPPASS] -d -md sha256</span>
<span class="token assign-left variable">BACKUPPASS</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># Directory to store backups</span>
<span class="token assign-left variable">LOCALDIR</span><span class="token operator">=</span><span class="token string">&quot;/root/backup/file/&quot;</span>

<span class="token comment"># Temporary directory used during backup creation</span>
<span class="token assign-left variable">TEMPDIR</span><span class="token operator">=</span><span class="token string">&quot;/root/backup/temp/&quot;</span>

<span class="token comment"># File to log the outcome of backups</span>
<span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span><span class="token string">&quot;/root/backup/backup.log&quot;</span>

<span class="token comment"># OPTIONAL:</span>
<span class="token comment"># If you want to backup the MySQL database, enter the MySQL root password below, otherwise leave it blank</span>
<span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># Below is a list of MySQL database name that will be backed up</span>
<span class="token comment"># If you want backup ALL databases, leave it blank.</span>
MYSQL_DATABASE_NAME<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># Below is a list of files and directories that will be backed up in the tar backup</span>
<span class="token comment"># For example:</span>
<span class="token comment"># File: /data/www/default/test.tgz</span>
<span class="token comment"># Directory: /data/www/default/test</span>
BACKUP<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&quot;/data/www/default/test&quot;</span>

<span class="token comment"># Number of days to store daily local backups (default 7 days)</span>
<span class="token assign-left variable">LOCALAGEDAILIES</span><span class="token operator">=</span><span class="token string">&quot;7&quot;</span>

<span class="token comment"># Delete remote file from Googole Drive or FTP server flag (true: delete, false: not delete)</span>
<span class="token assign-left variable">DELETE_REMOTE_FILE_FLG</span><span class="token operator">=</span>true

<span class="token comment"># Rclone remote name</span>
<span class="token assign-left variable">RCLONE_NAME</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># Rclone remote folder name (default &quot;&quot;)</span>
<span class="token assign-left variable">RCLONE_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># Cos remote folder name (default &quot;&quot;)</span>
<span class="token assign-left variable">COS_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># AliyunDrive remote folder name (default &quot;&quot;)</span>
<span class="token assign-left variable">ALI_FOLDER</span><span class="token operator">=</span><span class="token string">&quot;backup&quot;</span>

<span class="token comment"># Upload local file to FTP server flag (true: upload, false: not upload)</span>
<span class="token assign-left variable">FTP_FLG</span><span class="token operator">=</span>false

<span class="token comment"># Upload local file to Google Drive flag (true: upload, false: not upload)</span>
<span class="token assign-left variable">RCLONE_FLG</span><span class="token operator">=</span>false

<span class="token comment"># Upload local file to Cos flag (true: upload, false: not upload)</span>
<span class="token assign-left variable">COS_FLG</span><span class="token operator">=</span>false

<span class="token comment"># Upload local file to AliyunDrive flag (true: upload, false: not upload)</span>
<span class="token assign-left variable">ALI_FLG</span><span class="token operator">=</span>true
<span class="token comment"># AliyunDrive main.py</span>
<span class="token assign-left variable">ALI_PY_FILE</span><span class="token operator">=</span><span class="token string">&quot;main.py&quot;</span>
<span class="token assign-left variable">ALI_REFRESH_TOKEN</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># FTP server</span>
<span class="token comment"># OPTIONAL: If you want to upload to FTP server, enter the Hostname or IP address below</span>
<span class="token assign-left variable">FTP_HOST</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># FTP username</span>
<span class="token comment"># OPTIONAL: If you want to upload to FTP server, enter the FTP username below</span>
<span class="token assign-left variable">FTP_USER</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># FTP password</span>
<span class="token comment"># OPTIONAL: If you want to upload to FTP server, enter the username's password below</span>
<span class="token assign-left variable">FTP_PASS</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment"># FTP server remote folder</span>
<span class="token comment"># OPTIONAL: If you want to upload to FTP server, enter the FTP remote folder below</span>
<span class="token comment"># For example: public_html</span>
<span class="token assign-left variable">FTP_DIR</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>

<span class="token comment">########## END OF CONFIG ##########</span>

<span class="token comment"># Date &amp; Time</span>
<span class="token assign-left variable">DAY</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%d<span class="token variable">)</span></span>
<span class="token assign-left variable">MONTH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%m<span class="token variable">)</span></span>
<span class="token assign-left variable">YEAR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%C%y<span class="token variable">)</span></span>
<span class="token assign-left variable">BACKUPDATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d%H%M%S<span class="token variable">)</span></span>
<span class="token comment"># Backup file name</span>
<span class="token assign-left variable">TARFILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${LOCALDIR}</span>&quot;</span>&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">hostname</span><span class="token variable">)</span></span><span class="token string">&quot;_&quot;</span><span class="token variable">${BACKUPDATE}</span><span class="token string">&quot;.tgz
# Encrypted backup file name
ENC_TARFILE=&quot;</span><span class="token variable">${TARFILE}</span>.enc<span class="token string">&quot;
# Backup MySQL dump file name
SQLFILE=&quot;</span><span class="token variable">${TEMPDIR}</span>mysql_<span class="token variable">${BACKUPDATE}</span>.sql<span class="token string">&quot;

log() {
    #echo &quot;</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span><span class="token variable">)</span></span><span class="token string">&quot; &quot;</span><span class="token variable">$1</span><span class="token string">&quot;
    echo -e &quot;</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span><span class="token variable">)</span></span><span class="token string">&quot; &quot;</span><span class="token variable">$1</span><span class="token string">&quot; &gt;&gt; <span class="token variable">${LOGFILE}</span>
}

# Check for list of mandatory binaries
check_commands() {
    # This section checks for all of the binaries used in the backup
    # Do not check mysql command if you do not want to backup the MySQL database
    if [ -z &quot;</span><span class="token variable">${MYSQL_ROOT_PASSWORD}</span><span class="token string">&quot; ]; then
        BINARIES=( cat cd du date dirname echo openssl pwd rm tar )
    else
        BINARIES=( cat cd du date dirname echo openssl mysql mysqldump pwd rm tar )
    fi

    # Iterate over the list of binaries, and if one isn't found, abort
    for BINARY in &quot;</span><span class="token variable">${BINARIES<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token string">&quot;; do
        if [ ! &quot;</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">command</span> -v <span class="token string">&quot;<span class="token variable">$BINARY</span>&quot;</span><span class="token variable">)</span></span><span class="token string">&quot; ]; then
            log &quot;</span><span class="token variable">$BINARY</span> is not installed. Install it and try again<span class="token string">&quot;
            exit 1
        fi
    done

    # check rclone command
    RCLONE_COMMAND=false
    if [ &quot;</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">command</span> -v <span class="token string">&quot;rclone&quot;</span><span class="token variable">)</span></span><span class="token string">&quot; ]; then
        RCLONE_COMMAND=true
    fi

    # check COS command
    COS_COMMAND=false
    if [ &quot;</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">command</span> -v <span class="token string">&quot;coscmd&quot;</span><span class="token variable">)</span></span><span class="token string">&quot; ]; then
        COS_COMMAND=true
    fi

    # check AliyunDrive command
    ALI_COMMAND=false
    if [ ! -f &quot;</span><span class="token variable">${ALI_PY_FILE}</span><span class="token string">&quot; ]; then
        ALI_COMMAND=true
    fi

    # check ftp command
    if <span class="token variable">${FTP_FLG}</span>; then
        if [ ! &quot;</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">command</span> -v <span class="token string">&quot;ftp&quot;</span><span class="token variable">)</span></span><span class="token string">&quot; ]; then
            log &quot;</span><span class="token function">ftp</span> is not installed. Install it and try again<span class="token string">&quot;
            exit 1
        fi
    fi
}

calculate_size() {
    local file_name=<span class="token variable">$1</span>
    local file_size=<span class="token variable"><span class="token variable">$(</span><span class="token function">du</span> -h $file_name <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">)</span></span>
    if [ &quot;</span>x<span class="token variable">${file_size}</span><span class="token string">&quot; = &quot;</span>x<span class="token string">&quot; ]; then
        echo &quot;</span>unknown<span class="token string">&quot;
    else
        echo &quot;</span><span class="token variable">${file_size}</span><span class="token string">&quot;
    fi
}

# Backup MySQL databases
mysql_backup() {
    if [ -z &quot;</span><span class="token variable">${MYSQL_ROOT_PASSWORD}</span><span class="token string">&quot; ]; then
        log &quot;</span>MySQL root password not set, MySQL backup skipped<span class="token string">&quot;
    else
        log &quot;</span>MySQL dump start<span class="token string">&quot;
        mysql -u root -p&quot;</span><span class="token variable">${MYSQL_ROOT_PASSWORD}</span><span class="token string">&quot; 2&gt;/dev/null &lt;&lt;EOF
exit
EOF
        if [ <span class="token variable">$?</span> -ne 0 ]; then
            log &quot;</span>MySQL root password is incorrect. Please check it and try again<span class="token string">&quot;
            exit 1
        fi
        if [ &quot;</span><span class="token variable">${MYSQL_DATABASE_NAME<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token string">&quot; == &quot;</span>&quot; <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            mysqldump -u root -p<span class="token string">&quot;<span class="token variable">${MYSQL_ROOT_PASSWORD}</span>&quot;</span> --all-databases <span class="token operator">&gt;</span> <span class="token string">&quot;<span class="token variable">${SQLFILE}</span>&quot;</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                log <span class="token string">&quot;MySQL all databases backup failed&quot;</span>
                <span class="token builtin class-name">exit</span> <span class="token number">1</span>
            <span class="token keyword">fi</span>
            log <span class="token string">&quot;MySQL all databases dump file name: <span class="token variable">${SQLFILE}</span>&quot;</span>
            <span class="token comment">#Add MySQL backup dump file to BACKUP list</span>
            <span class="token assign-left variable">BACKUP</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">${BACKUP<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> <span class="token variable">${SQLFILE}</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span>
            <span class="token keyword">for</span> <span class="token for-or-select variable">db</span> <span class="token keyword">in</span> <span class="token variable">${MYSQL_DATABASE_NAME<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
                <span class="token builtin class-name">unset</span> DBFILE
                <span class="token assign-left variable">DBFILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${TEMPDIR}</span><span class="token variable">${db}</span>_<span class="token variable">${BACKUPDATE}</span>.sql&quot;</span>
                mysqldump -u root -p<span class="token string">&quot;<span class="token variable">${MYSQL_ROOT_PASSWORD}</span>&quot;</span> <span class="token variable">${db}</span> <span class="token operator">&gt;</span> <span class="token string">&quot;<span class="token variable">${DBFILE}</span>&quot;</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                    log <span class="token string">&quot;MySQL database name [<span class="token variable">${db}</span>] backup failed, please check database name is correct and try again&quot;</span>
                    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
                <span class="token keyword">fi</span>
                log <span class="token string">&quot;MySQL database name [<span class="token variable">${db}</span>] dump file name: <span class="token variable">${DBFILE}</span>&quot;</span>
                <span class="token comment">#Add MySQL backup dump file to BACKUP list</span>
                <span class="token assign-left variable">BACKUP</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">${BACKUP<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> <span class="token variable">${DBFILE}</span><span class="token punctuation">)</span>
            <span class="token keyword">done</span>
        <span class="token keyword">fi</span>
        log <span class="token string">&quot;MySQL dump completed&quot;</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">start_backup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${<span class="token operator">#</span>BACKUP<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>&quot;</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;Error: You must to modify the [<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $0<span class="token variable">)</span></span>] config before run it!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span>

    log <span class="token string">&quot;Tar backup file start&quot;</span>
    <span class="token function">tar</span> -zcPf <span class="token variable">${TARFILE}</span> <span class="token variable">${BACKUP<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -gt <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log <span class="token string">&quot;Tar backup file failed&quot;</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
    <span class="token keyword">fi</span>
    log <span class="token string">&quot;Tar backup file completed&quot;</span>

    <span class="token comment"># Encrypt tar file</span>
    <span class="token keyword">if</span> <span class="token variable">${ENCRYPTFLG}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        log <span class="token string">&quot;Encrypt backup file start&quot;</span>
        openssl enc -aes256 -in <span class="token string">&quot;<span class="token variable">${TARFILE}</span>&quot;</span> -out <span class="token string">&quot;<span class="token variable">${ENC_TARFILE}</span>&quot;</span> -pass pass:<span class="token string">&quot;<span class="token variable">${BACKUPPASS}</span>&quot;</span> -md sha256
        log <span class="token string">&quot;Encrypt backup file completed&quot;</span>

        <span class="token comment"># Delete unencrypted tar</span>
        log <span class="token string">&quot;Delete unencrypted tar file: <span class="token variable">${TARFILE}</span>&quot;</span>
        <span class="token function">rm</span> -f <span class="token variable">${TARFILE}</span>
    <span class="token keyword">fi</span>

    <span class="token comment"># Delete MySQL temporary dump file</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">sql</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> $<span class="token punctuation">{</span>TEMPDIR<span class="token punctuation">}</span>*.sql<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        log <span class="token string">&quot;Delete MySQL temporary dump file: <span class="token variable">${sql}</span>&quot;</span>
        <span class="token function">rm</span> -f <span class="token variable">${sql}</span>
    <span class="token keyword">done</span>

    <span class="token keyword">if</span> <span class="token variable">${ENCRYPTFLG}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">OUT_FILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${ENC_TARFILE}</span>&quot;</span>
    <span class="token keyword">else</span>
        <span class="token assign-left variable">OUT_FILE</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${TARFILE}</span>&quot;</span>
    <span class="token keyword">fi</span>
    log <span class="token string">&quot;File name: <span class="token variable">${OUT_FILE}</span>, File size: <span class="token variable"><span class="token variable">$(</span>calculate_size $<span class="token punctuation">{</span>OUT_FILE<span class="token punctuation">}</span><span class="token variable">)</span></span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># Transfer backup file to Google Drive</span>
<span class="token comment"># If you want to install rclone command, please visit website:</span>
<span class="token comment"># https://rclone.org/downloads/</span>
<span class="token function-name function">rclone_upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token variable">${RCLONE_FLG}</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">${RCLONE_COMMAND}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${RCLONE_NAME}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> log <span class="token string">&quot;Error: RCLONE_NAME can not be empty!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">&quot;<span class="token variable">${RCLONE_FOLDER}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            rclone <span class="token function">ls</span> <span class="token variable">${RCLONE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${RCLONE_FOLDER}</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&gt;</span> /dev/null
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                log <span class="token string">&quot;Create the path <span class="token variable">${RCLONE_NAME}</span>:<span class="token variable">${RCLONE_FOLDER}</span>&quot;</span>
                rclone <span class="token function">mkdir</span> <span class="token variable">${RCLONE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${RCLONE_FOLDER}</span>
            <span class="token keyword">fi</span>
        <span class="token keyword">fi</span>
        log <span class="token string">&quot;Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to Google Drive&quot;</span>
        rclone copy <span class="token variable">${OUT_FILE}</span> <span class="token variable">${RCLONE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${RCLONE_FOLDER}</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${LOGFILE}</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log <span class="token string">&quot;Error: Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to Google Drive failed&quot;</span>
            <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
        log <span class="token string">&quot;Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to Google Drive completed&quot;</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>


<span class="token comment"># Tranferring backup file to COS</span>
<span class="token function-name function">cos_upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token variable">${COS_FLG}</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">${COS_COMMAND}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${COS_FOLDER}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> log <span class="token string">&quot;Error: COS_FOLDER can not be empty!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">return</span> <span class="token number">1</span>
        log <span class="token string">&quot;Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to COS&quot;</span>
        coscmd upload <span class="token variable">${OUT_FILE}</span> <span class="token variable">${COS_FOLDER}</span>/ <span class="token operator">&gt;&gt;</span> <span class="token variable">${LOGFILE}</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log <span class="token string">&quot;Error: Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to COS&quot;</span>
            <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
        log <span class="token string">&quot;Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to COS completed&quot;</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Tranferring backup file to COS</span>
<span class="token function-name function">ali_upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token variable">${ALI_FLG}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${ALI_FOLDER}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> log <span class="token string">&quot;Error: ALI_FOLDER can not be empty!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">return</span> <span class="token number">1</span>
        log <span class="token string">&quot;Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to AliyunDrive&quot;</span>
        python3 <span class="token variable">${ALI_PY_FILE}</span> -t <span class="token variable">${ALI_REFRESH_TOKEN}</span> u <span class="token variable">${OUT_FILE}</span> /<span class="token variable">${ALI_FOLDER}</span>/ <span class="token operator">&gt;&gt;</span> <span class="token variable">${LOGFILE}</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log <span class="token string">&quot;Error: Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to AliyunDrive&quot;</span>
            <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
        log <span class="token string">&quot;Tranferring backup file: <span class="token variable">${OUT_FILE}</span> to AliyunDrive completed&quot;</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Tranferring backup file to FTP server</span>
<span class="token function-name function">ftp_upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token variable">${FTP_FLG}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FTP_HOST}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> log <span class="token string">&quot;Error: FTP_HOST can not be empty!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FTP_USER}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> log <span class="token string">&quot;Error: FTP_USER can not be empty!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FTP_PASS}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> log <span class="token string">&quot;Error: FTP_PASS can not be empty!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token punctuation">[</span> -z <span class="token string">&quot;<span class="token variable">${FTP_DIR}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> log <span class="token string">&quot;Error: FTP_DIR can not be empty!&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">FTP_OUT_FILE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $<span class="token punctuation">{</span>OUT_FILE<span class="token punctuation">}</span><span class="token variable">)</span></span>
        log <span class="token string">&quot;Tranferring backup file: <span class="token variable">${FTP_OUT_FILE}</span> to FTP server&quot;</span>
        <span class="token function">ftp</span> -in <span class="token variable">${FTP_HOST}</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${LOGFILE}</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
user <span class="token variable">$FTP_USER</span> <span class="token variable">$FTP_PASS</span>
binary
lcd <span class="token variable">$LOCALDIR</span>
cd <span class="token variable">$FTP_DIR</span>
put <span class="token variable">$FTP_OUT_FILE</span>
quit
EOF</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log <span class="token string">&quot;Error: Tranferring backup file: <span class="token variable">${FTP_OUT_FILE}</span> to FTP server failed&quot;</span>
            <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
        log <span class="token string">&quot;Tranferring backup file: <span class="token variable">${FTP_OUT_FILE}</span> to FTP server completed&quot;</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Get file date</span>
<span class="token function-name function">get_file_date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">#Approximate a 30-day month and 365-day year</span>
    <span class="token assign-left variable">DAYS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $<span class="token punctuation">((</span><span class="token number">10</span>#${YEAR}<span class="token operator">*</span><span class="token number">365</span><span class="token variable">))</span></span> + <span class="token variable"><span class="token variable">$((</span><span class="token number">10</span>#${MONTH}<span class="token operator">*</span><span class="token number">30</span><span class="token variable">))</span></span> + <span class="token variable"><span class="token variable">$((</span><span class="token number">10</span>#${DAY}<span class="token variable">))</span></span> <span class="token punctuation">))</span>
    <span class="token builtin class-name">unset</span> FILEYEAR FILEMONTH FILEDAY FILEDAYS FILEAGE
    <span class="token assign-left variable">FILEYEAR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d_ -f2 <span class="token operator">|</span> <span class="token function">cut</span> -c <span class="token number">1</span>-4<span class="token variable">)</span></span>
    <span class="token assign-left variable">FILEMONTH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d_ -f2 <span class="token operator">|</span> <span class="token function">cut</span> -c <span class="token number">5</span>-6<span class="token variable">)</span></span>
    <span class="token assign-left variable">FILEDAY</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token operator">|</span> <span class="token function">cut</span> -d_ -f2 <span class="token operator">|</span> <span class="token function">cut</span> -c <span class="token number">7</span>-8<span class="token variable">)</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${FILEYEAR}</span>&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;<span class="token variable">${FILEMONTH}</span>&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;<span class="token variable">${FILEDAY}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment">#Approximate a 30-day month and 365-day year</span>
        <span class="token assign-left variable">FILEDAYS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $<span class="token punctuation">((</span><span class="token number">10</span>#${FILEYEAR}<span class="token operator">*</span><span class="token number">365</span><span class="token variable">))</span></span> + <span class="token variable"><span class="token variable">$((</span><span class="token number">10</span>#${FILEMONTH}<span class="token operator">*</span><span class="token number">30</span><span class="token variable">))</span></span> + <span class="token variable"><span class="token variable">$((</span><span class="token number">10</span>#${FILEDAY}<span class="token variable">))</span></span> <span class="token punctuation">))</span>
        <span class="token assign-left variable">FILEAGE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> <span class="token number">10</span>#${DAYS} <span class="token operator">-</span> <span class="token number">10</span>#${FILEDAYS} <span class="token variable">))</span></span>
        <span class="token builtin class-name">return</span> <span class="token number">0</span>
    <span class="token keyword">fi</span>
    <span class="token builtin class-name">return</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment"># Delete Google Drive's old backup file</span>
<span class="token function-name function">delete_gdrive_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">FILENAME</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token keyword">if</span> <span class="token variable">${DELETE_REMOTE_FILE_FLG}</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">${RCLONE_COMMAND}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        rclone <span class="token function">ls</span> <span class="token variable">${RCLONE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${RCLONE_FOLDER}</span>/<span class="token variable">${FILENAME}</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&gt;</span> /dev/null
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            rclone delete <span class="token variable">${RCLONE_NAME}</span><span class="token builtin class-name">:</span><span class="token variable">${RCLONE_FOLDER}</span>/<span class="token variable">${FILENAME}</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${LOGFILE}</span>
            <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                log <span class="token string">&quot;Google Drive's old backup file: <span class="token variable">${FILENAME}</span> has been deleted&quot;</span>
            <span class="token keyword">else</span>
                log <span class="token string">&quot;Failed to delete Google Drive's old backup file: <span class="token variable">${FILENAME}</span>&quot;</span>
            <span class="token keyword">fi</span>
        <span class="token keyword">else</span>
            log <span class="token string">&quot;Google Drive's old backup file: <span class="token variable">${FILENAME}</span> is not exist&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Delete COS's old backup file</span>
<span class="token function-name function">delete_cos_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">FILENAME</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token keyword">if</span> <span class="token variable">${DELETE_REMOTE_FILE_FLG}</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">${COS_COMMAND}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        cos delete <span class="token variable">${COS_FOLDER}</span>/<span class="token variable">${FILENAME}</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${LOGFILE}</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log <span class="token string">&quot;COS's old backup file: <span class="token variable">${FILENAME}</span> has been deleted&quot;</span>
        <span class="token keyword">else</span>
            log <span class="token string">&quot;Failed to delete COS's old backup file: <span class="token variable">${FILENAME}</span>&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Delete AliyunDrive's old backup file</span>
<span class="token function-name function">delete_ali_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">FILENAME</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token keyword">if</span> <span class="token variable">${DELETE_REMOTE_FILE_FLG}</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">${ALI_COMMAND}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        python3 <span class="token variable">${ALI_PY_FILE}</span> -t <span class="token variable">${ALI_REFRESH_TOKEN}</span> del /<span class="token variable">${ALI_FOLDER}</span>/<span class="token variable">${FILENAME}</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${LOGFILE}</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log <span class="token string">&quot;AliyunDrive's old backup file: <span class="token variable">${FILENAME}</span> has been deleted&quot;</span>
        <span class="token keyword">else</span>
            log <span class="token string">&quot;Failed to delete AliyunDrive's old backup file: <span class="token variable">${FILENAME}</span>&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Delete FTP server's old backup file</span>
<span class="token function-name function">delete_ftp_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">FILENAME</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token keyword">if</span> <span class="token variable">${DELETE_REMOTE_FILE_FLG}</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">${FTP_FLG}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token function">ftp</span> -in <span class="token variable">${FTP_HOST}</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&gt;&gt;</span> <span class="token variable">${LOGFILE}</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
user <span class="token variable">$FTP_USER</span> <span class="token variable">$FTP_PASS</span>
cd <span class="token variable">$FTP_DIR</span>
del <span class="token variable">$FILENAME</span>
quit
EOF</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            log <span class="token string">&quot;FTP server's old backup file: <span class="token variable">${FILENAME}</span> has been deleted&quot;</span>
        <span class="token keyword">else</span>
            log <span class="token string">&quot;Failed to delete FTP server's old backup file: <span class="token variable">${FILENAME}</span>&quot;</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Clean up old file</span>
<span class="token function-name function">clean_up_files</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">cd</span> <span class="token variable">${LOCALDIR}</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span>
    <span class="token keyword">if</span> <span class="token variable">${ENCRYPTFLG}</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">LS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> *.enc<span class="token variable">)</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span>
        <span class="token assign-left variable">LS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> *.tgz<span class="token variable">)</span></span><span class="token punctuation">)</span>
    <span class="token keyword">fi</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> <span class="token variable">${LS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        get_file_date <span class="token variable">${f}</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">${FILEAGE}</span> -gt <span class="token variable">${LOCALAGEDAILIES}</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token comment">#rm -f ${f}</span>
                log <span class="token string">&quot;Old backup file name: <span class="token variable">${f}</span> has been deleted&quot;</span>
                delete_gdrive_file <span class="token variable">${f}</span>
                delete_ftp_file <span class="token variable">${f}</span>
                delete_cos_file <span class="token variable">${f}</span>
                delete_ali_file <span class="token variable">${f}</span>
            <span class="token keyword">fi</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">done</span>
<span class="token punctuation">}</span>

<span class="token comment"># 立即删除本地文件</span>
<span class="token function-name function">rm_local_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">cd</span> <span class="token variable">${LOCALDIR}</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span>
    <span class="token function">rm</span> -rf *.enc
<span class="token punctuation">}</span>

<span class="token comment"># Main progress</span>
<span class="token assign-left variable">STARTTIME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>

<span class="token comment"># Check if the backup folders exist and are writeable</span>
<span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;<span class="token variable">${LOCALDIR}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p <span class="token variable">${LOCALDIR}</span>
<span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;<span class="token variable">${TEMPDIR}</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> -p <span class="token variable">${TEMPDIR}</span>

log <span class="token string">&quot;Backup progress start&quot;</span>
check_commands
mysql_backup
start_backup
log <span class="token string">&quot;Backup progress complete&quot;</span>

log <span class="token string">&quot;Upload progress start&quot;</span>
rclone_upload
ftp_upload
cos_upload
ali_upload
log <span class="token string">&quot;Upload progress complete&quot;</span>

log <span class="token string">&quot;Cleaning up&quot;</span>
<span class="token comment">#rm_local_file</span>
clean_up_files
<span class="token assign-left variable">ENDTIME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>
<span class="token assign-left variable">DURATION</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>ENDTIME <span class="token operator">-</span> STARTTIME<span class="token variable">))</span></span>
log <span class="token string">&quot;All done&quot;</span>
log <span class="token string">&quot;Backup and transfer completed in <span class="token variable">${DURATION}</span> seconds&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br></div></div></details></div></div> <div class="page-slot page-slot-bottom"><script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//matomo.kimen.com.cn/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/kimentanm/kimen-blog/edit/master/docs/04.更多/04.折腾/02.重要数据备份并自动上传至阿里云盘.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/12/20, 09:41:36</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3426a4/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">【NAS In Docker】👨‍👩‍👧‍👦家庭数据中心 = 闲置台式机 + Docker</div></a> <a href="/pages/9b3f3a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">当『Infuse』遇上『阿里云盘』 🚀</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/3426a4/" class="prev">【NAS In Docker】👨‍👩‍👧‍👦家庭数据中心 = 闲置台式机 + Docker</a></span> <span class="next"><a href="/pages/9b3f3a/">当『Infuse』遇上『阿里云盘』 🚀</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8283f2/"><div>
            『MySQL5.7』创建用户并授权
            <!----></div></a> <span class="date">09-07</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/5ee34a/"><div>
            当『Emby、Plex、Jellyfin』遇上『阿里云盘』🎬
            <!----></div></a> <span class="date">08-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/9b3f3a/"><div>
            当『Infuse』遇上『阿里云盘』 🚀
            <!----></div></a> <span class="date">08-17</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:Kimentanm@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Kimentanm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2022
    <span>Kimen Tang | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.b9fd245f.js" defer></script><script src="/assets/js/2.e5fceb6b.js" defer></script><script src="/assets/js/24.f08b622f.js" defer></script>
  </body>
</html>
